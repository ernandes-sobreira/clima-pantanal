<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pantanal Clima â€” SÃ©ries, ComparaÃ§Ãµes e TendÃªncias</title>
  <meta name="description" content="Plataforma interativa para explorar sÃ©ries climÃ¡ticas do Pantanal: comparaÃ§Ã£o entre municÃ­pios, planalto/planÃ­cie, estatÃ­sticas descritivas e testes de tendÃªncia." />
  <link rel="stylesheet" href="styles.css" />
  <!-- Plotly for charts -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">ğŸŒ¦ï¸</div>
      <div>
        <div class="title">Pantanal Clima</div>
        <div class="subtitle">SÃ©ries temporais Â· ComparaÃ§Ãµes Â· TendÃªncias Â· EstatÃ­stica</div>
      </div>
    </div>
    <div class="top-actions">
      <button id="btnShare" class="btn ghost" title="Copiar link com filtros">Compartilhar</button>
      <button id="btnExport" class="btn" title="Exportar dados filtrados">Exportar CSV</button>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="panel-title">1) Filtros</div>

      <div class="grid">
        <div class="field">
          <label>Recorte</label>
          <div class="seg" role="tablist" aria-label="Recorte">
            <button class="segbtn active" data-scope="mun">MunicÃ­pios</button>
            <button class="segbtn" data-scope="loc">Planalto vs PlanÃ­cie</button>
            <button class="segbtn" data-scope="agg">Agregado (seleÃ§Ã£o)</button>
          </div>
          <div class="hint">â€œAgregadoâ€ calcula estatÃ­sticas sobre a seleÃ§Ã£o (ex: mÃ©dia entre municÃ­pios).</div>
        </div>

        <div class="field">
          <label>MunicÃ­pios</label>
          <select id="selMun" multiple size="8"></select>
          <div class="hint">Dica: use <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> para mÃºltiplos.</div>
        </div>

        <div class="field">
          <label>Planalto/PlanÃ­cie</label>
          <select id="selLoc" multiple size="4">
            <option value="PLANALTO">PLANALTO</option>
            <option value="PLANÃCIE">PLANÃCIE</option>
          </select>
          <div class="hint">Funciona melhor no modo â€œPlanalto vs PlanÃ­cieâ€.</div>
        </div>

        <div class="field">
          <label>VariÃ¡vel (Y)</label>
          <select id="selVar"></select>
          <div class="hint">VocÃª pode comparar duas variÃ¡veis na aba â€œCompararâ€.</div>
        </div>

        <div class="field">
          <label>AgregaÃ§Ã£o</label>
          <select id="selAgg">
            <option value="monthly">Mensal</option>
            <option value="annual">Anual</option>
          </select>
          <div class="hint">A base original jÃ¡ Ã© mensal (ym). â€œAnualâ€ agrega por ano.</div>
        </div>

        <div class="field">
          <label>PerÃ­odo</label>
          <div class="row">
            <select id="selStart"></select>
            <span class="sep">â†’</span>
            <select id="selEnd"></select>
          </div>
          <div class="hint">Ajuste o perÃ­odo para focar tendÃªncias.</div>
        </div>

        <div class="field">
          <label>SuavizaÃ§Ã£o</label>
          <select id="selSmooth">
            <option value="none">Sem</option>
            <option value="3">MÃ©dia mÃ³vel 3</option>
            <option value="6">MÃ©dia mÃ³vel 6</option>
            <option value="12">MÃ©dia mÃ³vel 12</option>
          </select>
          <div class="hint">MÃ©dia mÃ³vel simples (aplicada apÃ³s a agregaÃ§Ã£o).</div>
        </div>

        <div class="field">
          <label>Mostrar bandas</label>
          <div class="checks">
            <label><input type="checkbox" id="chkMinMax" checked /> minâ€“max</label>
            <label><input type="checkbox" id="chkStd" /> Â±1 desvio padrÃ£o</label>
            <label><input type="checkbox" id="chkMeanLine" checked /> mÃ©dia</label>
          </div>
          <div class="hint">Bandas sÃ£o calculadas sobre a seleÃ§Ã£o (municÃ­pios/loc).</div>
        </div>
      </div>

      <div class="panel-actions">
        <button id="btnUpdate" class="btn">Atualizar</button>
        <button id="btnReset" class="btn ghost">Reset</button>
      </div>
    </section>

    <section class="panel">
      <div class="panel-title">2) SÃ©ries temporais</div>
      <div id="chartTS" class="chart"></div>

      <div class="cards">
        <div class="card">
          <div class="card-h">Resumo (seleÃ§Ã£o)</div>
          <div id="boxSummary" class="mono small"></div>
        </div>
        <div class="card">
          <div class="card-h">TendÃªncia (robusta)</div>
          <div id="boxTrend" class="mono small"></div>
          <div class="small note">
            Teste de Mannâ€“Kendall (tau e p), inclinaÃ§Ã£o de Sen, regressÃ£o linear (inclinaÃ§Ã£o e RÂ²).
          </div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="panel-title">3) Comparar variÃ¡veis</div>

      <div class="grid2">
        <div class="field">
          <label>X</label>
          <select id="selX"></select>
        </div>
        <div class="field">
          <label>Y</label>
          <select id="selY"></select>
        </div>
        <div class="field">
          <label>Tipo</label>
          <select id="selCmp">
            <option value="scatter">DispersÃ£o</option>
            <option value="corr">Matriz de correlaÃ§Ã£o</option>
          </select>
        </div>
        <div class="field">
          <label>CorrelaÃ§Ã£o</label>
          <select id="selCorr">
            <option value="pearson">Pearson</option>
            <option value="spearman">Spearman</option>
          </select>
        </div>
      </div>

      <div id="chartCMP" class="chart"></div>
      <div id="boxCmpStats" class="mono small"></div>
    </section>

    <footer class="footer">
      <div>
        Feito para GitHub Pages (estÃ¡tico). Carrega o CSV localmente e roda tudo no navegador.
        <span class="muted">Dica: se o CSV crescer muito, a gente migra para â€œtilesâ€/parquet + WASM.</span>
      </div>
    </footer>
  </main>

  <div id="toast" class="toast" aria-live="polite"></div>
  <script src="app.js"></script>
</body>
</html>
