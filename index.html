<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pantanal Clima ‚Äî S√©ries, Compara√ß√µes e Tend√™ncias</title>
  <link rel="stylesheet" href="./styles.css"/>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs/%3E%3Ccircle cx='32' cy='32' r='30' fill='%230b1220'/%3E%3Cpath d='M18 38c10 2 18-7 28-2 0 8-7 14-14 14S20 46 18 38Z' fill='%2360a5fa'/%3E%3Cpath d='M18 30c8-10 20-10 28 0-9-3-19-3-28 0Z' fill='%2334d399'/%3E%3C/svg%3E"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">üåßÔ∏è</div>
      <div>
        <div class="title">Pantanal Clima</div>
        <div class="subtitle">S√©ries temporais ¬∑ Compara√ß√µes ¬∑ Tend√™ncias ¬∑ Estat√≠stica</div>
      </div>
    </div>

    <div class="top-actions">
      <div class="fontCtl">
        <label for="fontScale">Fonte</label>
        <input id="fontScale" type="range" min="100" max="140" step="5" value="110"/>
        <span id="fontScaleVal">110%</span>
      </div>
      <button id="btnAbout" class="btn ghost">Sobre</button>
      <button id="btnShare" class="btn ghost">Compartilhar</button>
      <button id="btnExport" class="btn primary">Exportar CSV</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="card-h">1) Filtros</div>

      <div class="grid2">
        <div>
          <div class="segrow">
            <div class="seg">
              <button class="segbtn" data-mode="view" id="modeView">Visualiza√ß√£o</button>
              <button class="segbtn" data-mode="compare" id="modeCompare">Compara√ß√£o</button>
              <button class="segbtn" data-mode="aggregate" id="modeAgg">Agregado</button>
            </div>
            <div class="hint" id="modeHint"></div>
          </div>

          <div class="row">
            <div class="field">
              <label>Munic√≠pios</label>
              <select id="selMun" multiple size="9"></select>
              <div class="note">Dica: use <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> para m√∫ltiplos.</div>
            </div>

            <div class="field">
              <label>Planalto/Plan√≠cie</label>
              <select id="selLoc" multiple size="3"></select>
              <div class="note">Opcional. Funciona melhor em ‚ÄúVisualiza√ß√£o‚Äù e ‚ÄúCompara√ß√£o‚Äù.</div>
            </div>

            <div class="field">
              <label>Vari√°vel (Y)</label>
              <select id="selVar"></select>
              <div class="note">No modo ‚ÄúCompara√ß√£o‚Äù, voc√™ compara munic√≠pios na mesma vari√°vel.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Agrega√ß√£o</label>
              <select id="selAgg">
                <option value="monthly">Mensal</option>
                <option value="annual">Anual</option>
              </select>
              <div class="note">‚ÄúAnual‚Äù agrega por ano (precip = soma; temperaturas = m√©dia).</div>
            </div>

            <div class="field">
              <label>Per√≠odo</label>
              <div class="inline">
                <select id="selStart"></select>
                <span class="dash">‚Äî</span>
                <select id="selEnd"></select>
              </div>
              <div class="note">Ajuste o per√≠odo para focar tend√™ncias.</div>
            </div>

            <div class="field">
              <label>Suaviza√ß√£o</label>
              <select id="selSmooth">
                <option value="0">Sem</option>
                <option value="3">M√©dia m√≥vel 3</option>
                <option value="5">M√©dia m√≥vel 5</option>
              </select>
              <div class="note">Aplicada ap√≥s agrega√ß√£o.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Linhas e bandas</label>
              <div class="checks">
                <label><input type="checkbox" id="chkMean" checked> m√©dia</label>
                <label><input type="checkbox" id="chkMin" checked> linha m√≠n</label>
                <label><input type="checkbox" id="chkMax" checked> linha m√°x</label>
                <label><input type="checkbox" id="chkMinMax" checked> faixa min‚Äìmax</label>
                <label><input type="checkbox" id="chkStd"> ¬±1 desvio padr√£o</label>
                <label><input type="checkbox" id="chkMK" checked> mostrar MK</label>
              </div>
              <div class="note">No modo ‚ÄúAgregado‚Äù, linhas s√£o calculadas sobre a sele√ß√£o.</div>
            </div>

            <div class="field">
              <label>Compara√ß√£o</label>
              <div class="inline">
                <span class="pill">m√°x grupos</span>
                <input id="maxCompare" type="number" min="2" max="12" value="5"/>
              </div>
              <div class="note">No modo ‚ÄúCompara√ß√£o‚Äù, escolha 2+ munic√≠pios (at√© o limite).</div>
            </div>

            <div class="field actions">
              <label>&nbsp;</label>
              <div class="inline">
                <button id="btnUpdate" class="btn primary">Atualizar</button>
                <button id="btnReset" class="btn ghost">Reset</button>
              </div>
              <div class="note">Se algo parecer ‚Äútravado‚Äù, use Ctrl+F5 para limpar cache.</div>
            </div>
          </div>
        </div>

        <div class="side">
          <div class="mini cardmini">
            <div class="mini-h">Resumo (sele√ß√£o)</div>
            <div id="statBox" class="mono small">‚Äî</div>
          </div>

          <div class="mini cardmini">
            <div class="mini-h">Tend√™ncia (robusta)</div>
            <div class="mono small" id="trendBox">‚Äî</div>
            <div class="note small">
              MK = Mann‚ÄìKendall (tend√™ncia monot√¥nica) ¬∑ Sen slope = inclina√ß√£o robusta.
            </div>
          </div>

          <div class="mini cardmini">
            <div class="mini-h">Leitura r√°pida</div>
            <ul class="bullets small" id="quickBox">
              <li>‚Äî</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-h">2) S√©ries temporais</div>
      <div id="tsChart" class="plot"></div>
    </section>

    <section class="card">
      <div class="card-h">3) Comparar vari√°veis</div>
      <div class="row">
        <div class="field">
          <label>X</label>
          <select id="selX"></select>
        </div>
        <div class="field">
          <label>Y</label>
          <select id="selY"></select>
        </div>
        <div class="field">
          <label>Tipo</label>
          <select id="selType">
            <option value="scatter">Dispers√£o</option>
            <option value="box">Boxplot (munic√≠pios)</option>
            <option value="corr">Matriz de correla√ß√£o</option>
          </select>
        </div>
        <div class="field">
          <label>Correla√ß√£o</label>
          <select id="selCorr">
            <option value="pearson">Pearson</option>
            <option value="spearman">Spearman</option>
          </select>
        </div>
        <div class="field">
          <label>Boxplot</label>
          <label class="checkline"><input type="checkbox" id="chkNoOut" checked> sem outliers</label>
        </div>
      </div>
      <div id="cmpChart" class="plot"></div>
      <div class="mono small" id="cmpStats">‚Äî</div>
    </section>

    <footer class="foot">
      Feito para GitHub Pages (est√°tico). Carrega o CSV localmente e roda tudo no navegador.
      Se o CSV crescer muito, a evolu√ß√£o √© tiles/parquet + DuckDB-WASM.
    </footer>
  </main>

  <script src="./app.js"></script>

  <div class="modal" id="aboutModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
      <div class="modal-head">
        <div class="modal-title" id="aboutTitle">Sobre a plataforma</div>
        <button class="btn ghost" id="btnAboutClose" aria-label="Fechar">‚úï</button>
      </div>
      <div class="modal-body">
        <p><strong>Pantanal Clima</strong> √© uma plataforma interativa para visualiza√ß√£o e an√°lise de s√©ries clim√°ticas dos munic√≠pios do Pantanal (planalto e plan√≠cie), com foco em ensino, pesquisa, extens√£o, inova√ß√£o e consulta p√∫blica.</p>
        <ul>
          <li><strong>Autor e curadoria dos dados:</strong> Ernandes Sobreira (UNEMAT)</li>
          <li><strong>Origem:</strong> dados clim√°ticos derivados via <em>Google Earth Engine</em> a partir de produtos de rean√°lise/sat√©lite (ex.: precipita√ß√£o, temperatura, umidade e √≠ndice de calor).</li>
          <li><strong>Recorte:</strong> s√©ries mensais por munic√≠pio (2001‚Äì2024, conforme dispon√≠vel).</li>
          <li><strong>An√°lises:</strong> resumo estat√≠stico, correla√ß√µes e tend√™ncia robusta (Mann‚ÄìKendall + inclina√ß√£o de Sen).</li>
        </ul>
        <p class="small muted">Observa√ß√£o: esta plataforma roda 100% no navegador (GitHub Pages). Resultados s√£o explorat√≥rios e devem ser interpretados com contexto climatol√≥gico e valida√ß√£o adicional quando aplic√°vel.</p>
      </div>
      <div class="modal-foot">
        <button class="btn primary" id="btnAboutOk">Entendi</button>
      </div>
    </div>
  </div>

</body>
</html>
